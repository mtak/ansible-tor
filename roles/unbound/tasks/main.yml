---

- name: Install unbound
  apt:
    name: unbound
    state: latest

- name: Set resolv.conf
  copy:
    src: resolv.conf
    dest: /etc/resolv.conf
    mode: 0444

- name: Disable ipv6
  copy:
    src: disable-ipv6.conf
    dest: /etc/unbound/unbound.conf.d/disable-ipv6.conf
    mode: 0644
  notify: restart_unbound
  when: ipv6_disabled|default(true)

- name: Enable ipv6
  file:
    path: /etc/unbound/unbound.conf.d/disable-ipv6.conf
    state: absent
  notify: restart_unbound
  when: not (ipv6_disabled|default(true))

- name: Enable unbound
  systemd:
    name: unbound
    state: started
    enabled: yes

